# ðŸ—¡ï¸ Mumei (ç„¡éŠ˜)

**Mathematical Proof-Driven Programming Language for AI Agents.**

ã€Œç„¡éŠ˜ï¼ˆMumeiï¼‰ã€ã¯ã€ä½œè€…ã®å€‹æ€§ã‚’æŽ’ã—ã€æ•°å­¦çš„ãªã€Œæ­£ã—ã•ã€ã®ã¿ã‚’è¿½æ±‚ã™ã‚‹AIãƒã‚¤ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªžã§ã™ã€‚AIãŒã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹éš›ã€å®Ÿè¡Œå‰ã«ãã®è«–ç†çš„æ¬ é™¥ã‚’æ•°å­¦çš„ã«è¨¼æ˜Žãƒ»æŽ’é™¤ã—ã€ä¸ç´”ç‰©ã®ãªã„ã€ŒçœŸå®Ÿã®ã‚³ãƒ¼ãƒ‰ã€ã®ã¿ã‚’ãƒžã‚·ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆLLVMï¼‰ãŠã‚ˆã³æ¤œè¨¼æ¸ˆã¿ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆRust/Go/TSï¼‰ã¸ã¨æ˜‡è¯ã•ã›ã¾ã™ã€‚

---

## âš–ï¸ Comparison with Formal Methods

Mumeiã¯ã€Leanã‚„Coqã®ã‚ˆã†ãªé‡åŽšãªå®šç†è¨¼æ˜Žæ”¯æ´ç³»ã¨ã€ç¾ä»£çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®æž¶ã‘æ©‹ã¨ãªã‚‹ã¹ãè¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

| ç‰¹å¾´ | Lean 4 / Coq | Mumei |
| :--- | :--- | :--- |
| æ¤œè¨¼ã®ä¸»ä½“ | äººé–“ï¼ˆæ•°å­¦çš„çŸ¥è­˜ãŒå¿…è¦ï¼‰ | SMTã‚½ãƒ«ãƒï¼ˆAIã«ã‚ˆã‚‹è‡ªå‹•æ¤œè¨¼ï¼‰ |
| å­¦ç¿’ã‚³ã‚¹ãƒˆ | éžå¸¸ã«é«˜ã„ | ä½Žï¼ˆä¸€èˆ¬çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«è¿‘ã„ï¼‰ |
| ä¸»ãªå‡ºåŠ› | ç‹¬è‡ªã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  / C | Rust, Go, TypeScript, LLVM |
| AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | è£œåŠ©çš„ãªåˆ©ç”¨ | é–‹ç™ºã®ä¸»ä½“ï¼ˆè‡ªå¾‹ä¿®æ­£ãƒ«ãƒ¼ãƒ—ï¼‰ |

---

## ðŸ› ï¸ è¨­è¨ˆæ€æƒ³ (Design Philosophy)

Mumeiã¯ä»¥ä¸‹ã®5ã¤ã®å·¥ç¨‹ï¼ˆé›é€ ãƒ—ãƒ­ã‚»ã‚¹ï¼‰ã‚’çµŒã¦ã€å®Ÿè¡Œãƒã‚¤ãƒŠãƒªã€æ¤œè¨¼æ¸ˆã¿ã‚½ãƒ¼ã‚¹ã€ãŠã‚ˆã³æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

1. **Polishing (Parser):** `atom` ã¨å‘¼ã°ã‚Œã‚‹æ¥µå°ã®é–¢æ•°å˜ä½ã§ã‚³ãƒ¼ãƒ‰ã‚’è§£æžã—ã¾ã™ã€‚`if-else` åˆ†å²ã€`let` ã«ã‚ˆã‚‹å¤‰æ•°æŸç¸›ã€ãƒ–ãƒ­ãƒƒã‚¯æ§‹æ–‡ `{}` ã‚’ã‚µãƒãƒ¼ãƒˆã€‚
2. **The Ritual of Truth (Verification):** Z3 SMT Solverã‚’ç”¨ã„ã€äº‹å‰æ¡ä»¶ (`requires`) ãŒå®Ÿè£… (`body`) ã®å®‰å…¨æ€§ã‚’æ•°å­¦çš„ã«æ‹…ä¿ã—ã¦ã„ã‚‹ã‹æ¤œè¨¼ã—ã¾ã™ã€‚
3. **Visual Inspection (Visualizer):** æ¤œè¨¼ã§ç™ºè¦‹ã•ã‚ŒãŸã€Œè«–ç†ã®äº€è£‚ï¼ˆåä¾‹ï¼‰ã€ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¦–è¦šåŒ–ã—ã¾ã™ã€‚
4. **Tempering (Codegen):** æ¤œè¨¼ã‚’ãƒ‘ã‚¹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ LLVM IR ã¸ã¨å¤‰æ›ã—ã€é«˜é€Ÿãªå®Ÿè¡Œèƒ½åŠ›ã‚’ä¸Žãˆã¾ã™ã€‚
5. **Sharpening (Transpiler):** æ¤œè¨¼æ¸ˆã¿ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®é«˜å“è³ªãª **Rust/Go/TypeScript** ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

---

## ðŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (Installation)

### 1. ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°Žå…¥

* **LLVM 15:** ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨
* **Z3 Solver:** è«–ç†æ¤œè¨¼ç”¨
* **Python 3.x:** ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã€ä¿®å¾©ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€MCPã‚µãƒ¼ãƒãƒ¼ç”¨

```bash
# macOS
brew install llvm@15 z3

# Ubuntu
sudo apt install llvm-15-dev libz3-dev

# Python dependencies
pip install streamlit pandas python-dotenv openai mcp-server-fastmcp

```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

```text
OPENAI_API_KEY=your_api_key_here

```

---

## ðŸ¤– MCP Server (AI Agent Integration)

Mumeiã¯ **Model Context Protocol (MCP)** ã«å¯¾å¿œã—ã¦ãŠã‚Šã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªå¾‹çš„ã«ã€Œæ­£ã—ã„ã‚³ãƒ¼ãƒ‰ã€ã‚’é›é€ ã™ã‚‹ãŸã‚ã®é“å…·ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

### æä¾›ã•ã‚Œã‚‹ãƒ„ãƒ¼ãƒ« (Tools)

* **`forge_blade`**: Mumeiã‚³ãƒ¼ãƒ‰ã‚’æ¤œè¨¼ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ»ãƒžãƒ«ãƒè¨€èªžå¤‰æ›ï¼ˆRust/Go/TSï¼‰ã—ã€æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆã‚’ä¸€æ‹¬è¿”å´ã—ã¾ã™ã€‚
* **`self_heal_loop`**: æ¤œè¨¼å¤±æ•—æ™‚ã«AIãŒè‡ªå¾‹çš„ã«ä¿®æ­£ã‚’è¡Œã†ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

---

## ðŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

* `src/parser.rs`: ASTå®šç¾©ã€`if-else` / `let` / `block` ã®æ§‹æ–‡è§£æžã€‚
* `src/verification.rs`: Z3ã«ã‚ˆã‚‹å½¢å¼æ¤œè¨¼ã€‚æ¡ä»¶åˆ†å²ã‚’è€ƒæ…®ã—ãŸ `Ite` è«–ç†ã®æ§‹ç¯‰ã€‚
* `src/transpiler.rs`: å¤šè¨€èªžå¤‰æ›ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆRust, Go, TypeScriptï¼‰ã€‚
* `src/codegen.rs`: LLVM IR ç”Ÿæˆã€‚
* `src/main.rs`: é›é€ å¸ä»¤å¡”ã€‚ä¸€æ‹¬å‡ºåŠ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®åˆ¶å¾¡ã€‚

---

## ðŸ—ºï¸ ãƒ­ãƒ¼ãƒ‰ãƒžãƒƒãƒ— (Roadmap)

* [x] **Multi-Language Support:** Rust, Go, TypeScript ã¸ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã€‚
* [x] **Control Flow:** `if-else` åˆ†å²ãŠã‚ˆã³ `let` å¤‰æ•°æŸç¸›ã®ã‚µãƒãƒ¼ãƒˆã€‚
* [x] **Stateless MCP Server:** ä¸¦è¡Œå®‰å…¨ãªä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ–¹å¼ã®å®Ÿè£…ã€‚
* [ ] **Loop Support:** `for` / `while` æ§‹æ–‡ãŠã‚ˆã³ **ãƒ«ãƒ¼ãƒ—ä¸å¤‰é‡ (Loop Invariant)** ã«ã‚ˆã‚‹å½¢å¼æ¤œè¨¼ã€‚
* [ ] **Standard Library:** é…åˆ—æ“ä½œã€æ•°å­¦é–¢æ•°ã€æ–‡å­—åˆ—å‡¦ç†ã®æ¤œè¨¼æ¸ˆã¿ã‚»ãƒƒãƒˆã®æ‹¡å……ã€‚
* [ ] **VS Code Extension:** ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆLanguage Server Protocolå¯¾å¿œï¼‰ã€‚

---

## ðŸ“– ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‰‹é †ï¼ˆå…·ä½“ä¾‹ï¼‰

Mumei ã¯ã€ä»¥ä¸‹ã® 4 ã‚¹ãƒ†ãƒƒãƒ—ã§ã€Œä»•æ§˜ã€ã‚’ã€Œå¤šè¨€èªžã®å®Ÿè£…ã€ã¸å¤‰æ›ã—ã¾ã™ã€‚

### 1. Atom ã®å®šç¾© (`sword_test.mm`)

æ•°å­¦çš„ãªåˆ¶ç´„ã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€Œåˆ†æ¯ `b` ãŒ `0` ã®ã¨ãã¯å®‰å…¨ã« `0` ã‚’è¿”ã—ã€ãã‚Œä»¥å¤–ã¯é™¤ç®—ã™ã‚‹ã€ã¨ã„ã†ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã¾ã™ã€‚

```mumei
atom safe_divide(a, b)
requires:
    true;
ensures:
    (b == 0 => result == 0) && (b != 0 => result == a / b);
body: {
    let res = if b == 0 {
        0
    } else {
        a / b
    };
    res
};

```

### 2. æ¤œè¨¼ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®å®Ÿè¡Œ

```bash
cargo run -- sword_test.mm --output katana

```

### 3. ãƒ—ãƒ­ã‚»ã‚¹ã®å†…éƒ¨å‹•ä½œ

1. **Polishing:** `if-else` ã‚„ `let res = ...` ãŒ ASTï¼ˆæŠ½è±¡æ§‹æ–‡æœ¨ï¼‰ã«å¤‰æ›ã•ã‚Œã¾ã™ã€‚
2. **Verification:** Z3 ãŒã€Œ`b` ãŒ `0` ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ï¼Ÿã€ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ `if b == 0` ã§ã‚¬ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€**é™¤ç®—ãƒ‘ã‚¹ã« `b=0` ãŒå…¥ã‚Šè¾¼ã¾ãªã„ã“ã¨ãŒæ•°å­¦çš„ã«è¨¼æ˜Ž**ã•ã‚Œã€æ¤œè¨¼ã‚’ãƒ‘ã‚¹ã—ã¾ã™ã€‚
3. **Tempering:** é«˜é€Ÿãªå®Ÿè¡Œç”¨ã®ä¸­é–“ã‚³ãƒ¼ãƒ‰ `katana.ll` ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
4. **Sharpening:** æ¤œè¨¼æ¸ˆã¿ãƒ­ã‚¸ãƒƒã‚¯ãŒ 3 è¨€èªžã§æ›¸ãå‡ºã•ã‚Œã¾ã™ã€‚

### 4. ç”Ÿæˆç‰©ã®ç¢ºèª

æ¤œè¨¼ã‚’ãƒ‘ã‚¹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

* **`katana.rs` (Rust):** `pub fn safe_divide(a: i64, b: i64) -> i64 { ... }`
* **`katana.go` (Go):** `func safe_divide(a int64, b int64) int64 { ... }`
* **`katana.ts` (TypeScript):** `function safe_divide(a: any, b: any): any { ... }`

---
