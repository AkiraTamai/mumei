# ğŸ›  Mumei Toolchain (mmx) Design

## Current Status

Mumei currently provides the `mumei` CLI with the following commands:

| Command | Status | Description |
|---|---|---|
| `mumei build` | âœ… Implemented | Full pipeline: verify + codegen + transpile |
| `mumei verify` | âœ… Implemented | Z3 verification only |
| `mumei check` | âœ… Implemented | Parse + resolve + monomorphize (no Z3) |
| `mumei init` | âœ… Implemented | Project scaffolding with `mumei.toml` |
| `mumei doctor` | âœ… Implemented | Environment check (Z3, LLVM, Rust, Go, Node.js, std library) |

### Installation

```bash
# From source (requires Rust toolchain)
cargo install --path .

# Or build locally
./build_and_run.sh
```

### `mumei doctor` Output Example

```
ğŸ©º Mumei Doctor: checking development environment...

  Mumei compiler: v0.1.0
  âœ… Z3: Z3 version 4.13.0
  âœ… LLVM: LLVM version 18.1.8
  âœ… Rust: rustc 1.82.0
  âœ… Go: go version go1.23.0 darwin/arm64
  âœ… Node.js: v22.0.0
  âœ… std library: 7/7 modules found
  â„¹ï¸  mumei.toml: not found (not in a Mumei project directory)

âœ… Doctor: 7 ok â€” all tools available
```

Checks performed:
- **Z3 solver** (required): `z3 --version`
- **LLVM** (required): `llc-18 --version` or `llc --version`
- **Rust** (optional): for generated `.rs` syntax checking
- **Go** (optional): for generated `.go` compilation
- **Node.js** (optional): for generated `.ts` execution
- **std library**: 7 modules (`prelude`, `option`, `result`, `list`, `stack`, `alloc`, `container/bounded_array`)
- **mumei.toml**: project directory detection

### Project Manifest (`mumei.toml`)

Generated by `mumei init`. Currently used for project metadata only (parsing planned).

```toml
[package]
name = "my_project"
version = "0.1.0"

[dependencies]
# Future: package registry support
# math_utils = { git = "https://github.com/user/math-mm", rev = "main" }

[build]
# Future: target language selection
# targets = ["rust", "go", "typescript"]
```

---

## Future: mmx (Mumei Multi-tool)

### Phase 1: Environment Bundler (`mmx setup`)

Automatic dependency installation without manual `brew install`:

```bash
mmx setup
# Detects OS (macOS/Linux)
# Downloads and configures Z3 solver
# Downloads and configures LLVM 18
# Verifies all dependencies
```

Implementation approach:
- Download pre-built Z3/LLVM binaries for the target platform
- Store in `~/.mumei/toolchains/`
- Set environment variables automatically
- Fall back to system-installed versions if available

### Phase 2: Manifest System

Full `mumei.toml` support:

```toml
[package]
name = "my_verified_lib"
version = "1.0.0"
authors = ["name"]
description = "A formally verified math library"

[dependencies]
std = { version = "0.1.0" }

[build]
targets = ["rust", "go"]
verify = true
max_unroll = 5

[proof]
cache = true
timeout_ms = 10000
```

### Phase 3: Local Registry

```bash
mmx add ./path/to/verified-math
```

Package resolution order:
1. Project-local `deps/` directory
2. `~/.mumei/packages/` global cache
3. Remote registry (future)

### Phase 4: Proof Caching and Sharing

```bash
mmx publish --proof-only
mmx add verified-math  # Downloads code + proof cache
```

Proof artifacts include:
- Per-atom SHA-256 hash (already implemented in `.mumei_build_cache`)
- Z3 proof certificates (future)
- Verification timestamp and solver version

### Phase 5: AI Integration

```bash
mmx doctor --ai
# Output: structured JSON with error context, counter-examples,
# and suggested fixes for AI agents
```

LSP integration roadmap:
- Inline Z3 counter-example display in editors
- Real-time verification status per atom
- Auto-completion for requires/ensures expressions
- Hover documentation for std library atoms

---

## Architecture

```
mmx (future)
â”œâ”€â”€ mmx setup          # Environment bundler
â”œâ”€â”€ mmx add            # Dependency management
â”œâ”€â”€ mmx publish        # Registry publishing
â”œâ”€â”€ mmx doctor --ai    # AI context generation
â””â”€â”€ mmx lsp            # Language server

mumei (current)
â”œâ”€â”€ mumei build        # Full pipeline
â”œâ”€â”€ mumei verify       # Z3 only
â”œâ”€â”€ mumei check        # Syntax only
â”œâ”€â”€ mumei init         # Project scaffolding
â””â”€â”€ mumei doctor       # Environment check
```
